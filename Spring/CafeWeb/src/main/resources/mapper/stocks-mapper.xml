<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycom.myapp.stock.dao.StockDao">
  <select id="findAllStocks" resultType="com.mycom.myapp.stock.dto.StockDto">
    select s.id, s.product_id, p.name as product_name, s.quantity
    from Stocks as s
    LEFT JOIN Products p ON p.id = s.product_id
    ORDER BY s.id DESC
    LIMIT #{pageSize} OFFSET #{offset}
  </select>

  <select id="countAll" resultType="int">
    select count(*)
    from Stocks as s
    LEFT JOIN Products p ON p.id = s.product_id
  </select>

  <select id="findByProductId" parameterType="int" resultType="com.mycom.myapp.stock.dto.StockDto">
    select id, product_id, quantity
    from Stocks
    where product_id = #{productId}
  </select>

  <update id="updateStockQuantity" parameterType="com.mycom.myapp.stock.dto.StockUpdateDto">
    UPDATE Stocks
    SET quantity = quantity + #{add}
    WHERE product_id = #{productId}
  </update>

  <insert id="initStock" parameterType="com.mycom.myapp.stock.dto.StockDto">
    INSERT INTO Stocks (product_id, quantity)
    VALUES (#{productId}, 0)
  </insert>

</mapper>